---
title: "Phyluce"
output: html_notebook
---

This notebook will document my work with the package [Phyluce](http://phyluce.readthedocs.io/en/latest/index.html) by Brant Faircloth.

1. Installed [Anaconda with Python 2.7](https://docs.anaconda.com/anaconda/install/)

2. Installed Phyluce (used extra advice from [here](https://github.com/faircloth-lab/phyluce/issues/57) to create a new environment)
```{bash}
M053-303-26932:~ cran5048$ conda create --name phyluce
Solving environment: done


## Package Plan ##

  environment location: /anaconda2/envs/phyluce


Proceed ([y]/n)? y

Preparing transaction: done
Verifying transaction: done
Executing transaction: done
#
# To activate this environment, use:
# > source activate phyluce
#
# To deactivate an active environment, use:
# > source deactivate
#
M053-303-26932:~ cran5048$ source activate phyluce
(phyluce) M053-303-26932:~ cran5048$ conda install phyluce
Solving environment: done


M053-303-26932:~ cran5048$ conda install phyluce
Downloading and Extracting Packages
gblocks 0.91b: ########################################################################## | 100% 
raxml 8.0.19: ########################################################################### | 100% 
abyss 1.3.7: ############################################################################ | 100% 
pandas 0.13.0: ########################################################################## | 100% 
dateutil 2.4.1: ######################################################################### | 100% 
pysam 0.7.7: ############################################################################ | 100% 
bx-python 0.7.1: ######################################################################## | 100% 
biopython 1.63: ######################################################################### | 100% 
numpy 1.7.1: ############################################################################ | 100% 
mafft 7.130: ############################################################################ | 100% 
trimmomatic 0.32: ####################################################################### | 100% 
pip 9.0.3: ############################################################################## | 100% 
wheel 0.31.0: ########################################################################### | 100% 
bedtools 2.18.1: ######################################################################## | 100% 
bwa 0.7.7: ############################################################################## | 100% 
python 2.7.14: ########################################################################## | 100% 
illumiprocessor 2.0.7: ################################################################## | 100% 
samtools 0.1.19: ######################################################################## | 100% 
muscle 3.8.31: ########################################################################## | 100% 
setuptools 39.0.1: ###################################################################### | 100% 
pyvcf 0.6.4: ############################################################################ | 100% 
condaflmake 3.8.2: ###################################################################### | 100% 
dendropy 3.12.0: ######################################################################## | 100% 
bowtie 1.1.1: ########################################################################### | 100% 
trinity 2.0.6: ########################################################################## | 100% 
distribute 0.6.45: ###################################################################### | 100% 
velvet 1.2.10: ########################################################################## | 100% 
lastz 1.02.00: ########################################################################## | 100% 
phyluce 1.5.0: ########################################################################## | 100% 
picard 1.106: ########################################################################### | 100% 
gatk-lite 2.3.0: ######################################################################## | 100% 
pytz 2018.3: ############################################################################ | 100% 
Preparing transaction: done
Verifying transaction: done
Executing transaction: done


#illumiprocessor isn't working so I removed it and reinstalled it (used force to only remove this package)
conda remove illumiprocessor --force
conda install illumiprocessor #upgrades from 2.0.7 to 2.0.8

# and install Java 8 (I have 10 installed)
brew cask install caskroom/versions/java8
#now install jenv to manage java versions, add init line to .bash_profile as suggested here https://gist.github.com/tomysmile/a9a7aee85ff73454bd57e198ad90e614
brew install jenv
#find paths to java installations
/usr/libexec/java_home -V
# add java8 to jenv
jenv add /Library/Java/JavaVirtualMachines/jdk1.8.0_162.jdk/Contents/Home
jenv versions
#set java version to 8
jenv local 1.8.0.162

#So I fixed the lines 28 and 33 in #~/anaconda2/envs/phyluce/lib/python2.7/site-packages/illumiprocessor/cli/main.py

#to add "anaconda2" in the paths there (which originally just had "anaconda")

```

3. Rename directories to reflect the sample

```{bash, evaluate=F}
for dir in */
  do
  cd $dir
  for file in *.gz; do
    cd ..
    mv $dir ${file%%_L001_R1_001.fastq.gz}
    break 1
    done
  done
  "$dir"*.gz
```

4. Copy all files into phyluce directory

```{bash, evaluate=F}
for dir in */; do
cd $dir
  for f in *.gz; do
  cp $f ../phyluce/$f
  done
cd ..
done

```

5. Cat together two individuals that were sequenced twice (once when I thought I wasn't going to include most S. ovalis in the run)

```{bash, evaluate=F}
cat sebova-sbc-R010965_S23_L001_R1_001.fastq.gz sebova-sbc-R010965_S44_L001_R1_001.fastq.gz > sebova-sbc-R010965_S2344_L001_R1_001.fastq.gz


cat sebova-sbc-R010965_S23_L001_R2_001.fastq.gz sebova-sbc-R010965_S44_L001_R2_001.fastq.gz > sebova-sbc-R010965_S2344_L001_R2_001.fastq.gz


cat sebova-sbc-R010966_S24_L001_R1_001.fastq.gz sebova-sbc-R010966_S45_L001_R1_001.fastq.gz > sebova-sbc-R010966_S2445_L001_R1_001.fastq.gz


cat sebova-sbc-R010966_S24_L001_R2_001.fastq.gz sebova-sbc-R010966_S45_L001_R2_001.fastq.gz > sebova-sbc-R010966_S2445_L001_R2_001.fastq.gz


rm sebova-sbc-R010965_S23_L001_R1_001.fastq.gz sebova-sbc-R010965_S44_L001_R1_001.fastq.gz
rm sebova-sbc-R010965_S23_L001_R2_001.fastq.gz sebova-sbc-R010965_S44_L001_R2_001.fastq.gz
rm sebova-sbc-R010966_S24_L001_R1_001.fastq.gz sebova-sbc-R010966_S45_L001_R1_001.fastq.gz
rm sebova-sbc-R010966_S24_L001_R2_001.fastq.gz sebova-sbc-R010966_S45_L001_R2_001.fastq.gz
```

4. Run illumiprocessor to trim adapters and low quality bases
```{bash, evaluate=F}
illumiprocessor --input ./ --output uce-clean --config illumiprocessor_UCE2_config.txt --cores 4
```

